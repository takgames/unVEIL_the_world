<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>(非公式) unVEIL the world ダメージシミュレーター</title>
  <link rel="stylesheet" href="styles.css" />
  <script defer src="formulas.js"></script>
  <script defer src="app.js"></script>
</head>

<body>
  <header class="header-bar">
    <h1>unVEIL the world ダメージシミュレーター</h1>
    <div class="header-actions">
      <button id="resetBtn" class="reset-btn btn-sm" title="入力値を初期状態に戻します">↺ リセット</button>

      <div class="menu-anchor">
        <button id="shareUrlBtn" class="share-btn btn-sm">
          <span class="share-icon">🔗</span><span>共有URLをコピー</span>
        </button>
        <div id="shareMenu" class="menu" role="menu" aria-hidden="true">
          <button id="copyPlainBtn" role="menuitem">URLをコピー</button>
          <button id="copyMarkdownBtn" role="menuitem">Markdownでコピー</button>
        </div>
      </div>

      <button id="themeBtn" class="btn-icon btn-sm" title="ライト/ダーク切替">🌗</button>
      <button id="helpBtn" class="btn-icon btn-sm" title="使い方">ℹ️</button>
    </div>
  </header>

  <main>
    <!-- プリセット -->
    <section class="card collapsible" data-collapse-id="preset">
      <div class="card-header" role="button" tabindex="0" aria-expanded="false">
        <h2>プリセット</h2>
      </div>
      <div class="card-body">
        <div class="preset-row">
          <!-- ← 左：名前入力＋新規保存／名前変更 -->
          <div class="left-group">
            <label>新規／変更後の名前
              <input id="presetName" type="text" />
            </label>
            <div class="btn-row">
              <button id="saveBtn" class="primary">新規保存</button>
              <button id="renameBtn" class="ghost">名前変更</button>
            </div>
          </div>

          <!-- → 右：プリセット一覧＋上書き／削除 -->
          <div class="right-group">
            <label>プリセット一覧
              <select id="presetSelect"></select>
            </label>
            <div class="btn-row">
              <button id="overwriteBtn" class="primary">上書き保存</button>
              <button id="deleteBtn" class="ghost">削除</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ステータス -->
    <section class="card collapsible" data-collapse-id="status">
      <div class="card-header" role="button" tabindex="0" aria-expanded="true">
        <h2>ステータス</h2>
      </div>
      <div class="card-body">
        <div class="grid">
          <label>攻撃力（基礎値）<input id="atkBase" type="number" min="0" value="2000" /></label>
          <label>攻撃力（補正値）<input id="atkBonus" type="number" min="0" value="100" /></label>
          <label>会心率(%)<input id="critRateBase" type="number" min="0" max="100" value="10" /></label>
          <label>会心ダメージ(%)<input id="critDmgBase" type="number" min="0" value="50" /></label>
        </div>
      </div>
    </section>

    <!-- 装備ステータス -->
    <section class="card collapsible" data-collapse-id="equip">
      <div class="card-header" role="button" tabindex="0" aria-expanded="true">
        <h2>装備ステータス</h2>
      </div>
      <div class="card-body">
        <div class="equip-scroll-wrapper">
          <div class="equip-grid">
            <div class="equip-head"></div>
            <div class="equip-head">メイン種類</div>
            <div class="equip-head">メイン値</div>
            <div class="equip-head">攻撃力</div>
            <div class="equip-head">攻撃力補正(%)</div>
            <div class="equip-head">会心率(%)</div>
            <div class="equip-head">会心ダメージ(%)</div>

            <!-- グローブ（メイン：攻撃力 固定） -->
            <div class="equip-name">グローブ</div>
            <span class="fixed-label">攻撃力</span>
            <input id="eq_glove_mainVal" type="number" value="0" />
            <input id="eq_glove_atk" type="number" value="0" />
            <input id="eq_glove_atkPct" type="number" step="0.1" value="0" />
            <input id="eq_glove_critRate" type="number" step="0.1" value="0" />
            <input id="eq_glove_critDmg" type="number" step="0.1" value="0" />
            <!-- 内部値保持用（collectParams が読む） -->
            <input id="eq_glove_mainType" type="hidden" value="atk" />

            <!-- 服（メイン：その他 固定＝計算には影響しない） -->
            <div class="equip-name">服</div>
            <span class="fixed-label">その他</span>
            <input id="eq_clothes_mainVal" type="number" value="0" disabled />
            <input id="eq_clothes_atk" type="number" value="0" />
            <input id="eq_clothes_atkPct" type="number" step="0.1" value="0" />
            <input id="eq_clothes_critRate" type="number" step="0.1" value="0" />
            <input id="eq_clothes_critDmg" type="number" step="0.1" value="0" />
            <input id="eq_clothes_mainType" type="hidden" value="other" />

            <!-- 紋章（メイン：攻撃力 / 攻撃力補正% / 属性ダメ%） -->
            <div class="equip-name">紋章</div>
            <select id="eq_crest_mainType">
              <option value="atk">攻撃力</option>
              <option value="atkPct">攻撃力補正%</option>
              <option value="elemPct">属性ダメージ%</option>
              <option value="other">その他</option>
            </select>
            <input id="eq_crest_mainVal" type="number" step="0.1" value="0" />
            <input id="eq_crest_atk" type="number" value="0" />
            <input id="eq_crest_atkPct" type="number" step="0.1" value="0" />
            <input id="eq_crest_critRate" type="number" step="0.1" value="0" />
            <input id="eq_crest_critDmg" type="number" step="0.1" value="0" />

            <!-- 指輪（メイン：攻撃力 / 攻撃力補正% / 会心率% / 会心ダメ%） -->
            <div class="equip-name">指輪</div>
            <select id="eq_ring_mainType">
              <option value="atk">攻撃力</option>
              <option value="atkPct">攻撃力補正%</option>
              <option value="critRate">会心率%</option>
              <option value="critDmg">会心ダメージ%</option>
              <option value="other">その他</option>
            </select>
            <input id="eq_ring_mainVal" type="number" step="0.1" value="0" />
            <input id="eq_ring_atk" type="number" value="0" />
            <input id="eq_ring_atkPct" type="number" step="0.1" value="0" />
            <input id="eq_ring_critRate" type="number" step="0.1" value="0" />
            <input id="eq_ring_critDmg" type="number" step="0.1" value="0" />

            <!-- ブローチ（メイン：攻撃力 / 攻撃力補正% / 会心ダメ%） -->
            <div class="equip-name">ブローチ</div>
            <select id="eq_brooch_mainType">
              <option value="atk">攻撃力</option>
              <option value="atkPct">攻撃力補正%</option>
              <option value="critDmg">会心ダメージ%</option>
              <option value="other">その他</option>
            </select>
            <input id="eq_brooch_mainVal" type="number" step="0.1" value="0" />
            <input id="eq_brooch_atk" type="number" value="0" />
            <input id="eq_brooch_atkPct" type="number" step="0.1" value="0" />
            <input id="eq_brooch_critRate" type="number" step="0.1" value="0" />
            <input id="eq_brooch_critDmg" type="number" step="0.1" value="0" />
          </div>
        </div>
        <div class="equip-summary">
          <div class="sum-title">装備合計</div>
          <div id="equipBadges" class="sum-badges">
            <!-- JS で埋め込み -->
          </div>
        </div>
      </div>
    </section>

    <!-- スキル -->
    <section class="card collapsible" data-collapse-id="skill">
      <div class="card-header" role="button" tabindex="0" aria-expanded="true">
        <h2>スキル</h2>
      </div>
      <div class="card-body">
        <div class="grid">
          <label>スキル攻撃(%)<input id="skillRate" type="number" min="0" value="100" /></label>
          <label>スキル固定値<input id="skillFlat" type="number" min="0" value="0" /></label>
        </div>
      </div>
    </section>

    <!-- バフ -->
    <section class="card collapsible" data-collapse-id="buff">
      <div class="card-header" role="button" tabindex="0" aria-expanded="true">
        <h2>バフ</h2>
      </div>
      <div class="card-body">
        <div class="grid">
          <label>カード系ダメージアップ(%)<input id="cardBuff" type="number" min="0" step="0.5" value="0" /></label>
          <label>全体ダメージアップ(%)<input id="globalBuff" type="number" min="0" step="0.5" value="0" /></label>
          <label>属性ダメージアップ(%)<input id="elementBuff" type="number" min="0" step="0.5" value="0" /></label>
          <label>攻撃力アップ(%)<input id="atkBuff" type="number" min="0" step="0.5" value="0" /></label>
        </div>
      </div>
    </section>

    <!-- 敵 -->
    <section class="card collapsible" data-collapse-id="enemy">
      <div class="card-header" role="button" tabindex="0" aria-expanded="true">
        <h2>敵</h2>
      </div>
      <div class="card-body">
        <div class="grid enemy-grid">
          <label>防御力<input id="def" type="number" min="0" value="0" /></label>
          <label>属性相性
            <select id="affinity">
              <option value="none">なし（×1.00）</option>
              <option value="adv">有利（×1.25）</option>
              <option value="dis">不利（×0.85）</option>
            </select>
          </label>
          <label class="break-check"><input type="checkbox" id="applyBreak" />ブレイク状態（×1.30）</label>
        </div>
      </div>
    </section>

    <!-- 結果 -->
    <section id="resultCard" class="card" data-nocollapse="1">
      <div class="card-header">
        <h2>結果</h2>
      </div>
      <div class="card-body">
        <div class="bar big">
          <div id="fill-critOn" class="fill critOn"></div>
          <div id="fill-expected" class="fill expected"></div>
          <div id="fill-noCrit" class="fill noCrit"></div>
        </div>
        <div class="legend">
          <span class="leg leg-noCrit">🟦 通常ダメージ <strong id="leg-noCrit">0</strong></span>
          <span class="leg leg-expected">🟩 平均ダメージ(期待値) <strong id="leg-expected">0</strong></span>
          <span class="leg leg-critOn">🟥 会心ダメージ <strong id="leg-critOn">0</strong></span>
        </div>
      </div>
    </section>

    <!-- 途中値 -->
    <section class="card collapsible" data-collapse-id="breakdown">
      <div class="card-header" role="button" tabindex="0" aria-expanded="false">
        <h2>途中値（内訳）</h2>
      </div>
      <div class="card-body">
        <table class="breakdown">
          <tbody id="breakdown-body"></tbody>
        </table>
      </div>
    </section>

    <footer>
      <span class="note">
        &copy;2025 Tak (ver.1.0.2)<br>本シミュレーターは実測検証に基づいた近似値の推測を目的としているため、実際のゲームプレイにおける結果と一致することを保証するものではありません。
      </span>
    </footer>
  </main>

  <!-- Help Modal -->
  <div id="helpOverlay" class="overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="helpTitle">
      <div class="modal-header">
        <h3 id="helpTitle">使い方ガイド</h3>
        <button id="helpClose" class="btn-icon" aria-label="閉じる">✕</button>
      </div>
      <div class="modal-body">
        <ol>
          <li><b>ステータス/スキル/バフ/敵</b>を入力すると自動計算します。</li>
          <li><b>結果</b>は「通常/平均/会心」を1本のバーで比較表示します。</li>
          <li><b>プリセット</b>で設定を保存できます。プルダウン選択で即適用。</li>
          <li><b>共有URL</b>は現在の入力をURLに埋め込みます。Markdownコピーも可。</li>
          <li><b>内訳</b>で途中計算の値を確認できます。丸めは最終のみ切り捨て。</li>
        </ol>
      </div>
      <div class="modal-footer">
        <label class="row"><input id="helpDontShow" type="checkbox" /> 次回から自動表示しない</label>
        <button id="helpOk" class="ghost">閉じる</button>
      </div>
    </div>
  </div>

  <!-- 固定ドック：結果カードの見た目そのまま -->
  <div id="resultDock" class="result-dock" aria-hidden="true">
    <div class="result-dock-inner">
      <section class="card">
        <div class="card-header">
          <h2>結果</h2>
        </div>
        <div class="card-body">
          <!-- ★ 本体と同じ構造・同じクラス。IDだけ Dock 用に -->
          <div class="bar big">
            <div id="fill-critOn-dock" class="fill critOn"></div>
            <div id="fill-expected-dock" class="fill expected"></div>
            <div id="fill-noCrit-dock" class="fill noCrit"></div>
          </div>
          <div class="legend">
            <span class="leg leg-noCrit">🟦 通常ダメージ <strong id="leg-noCrit-dock">0</strong></span>
            <span class="leg leg-expected">🟩 平均ダメージ(期待値) <strong id="leg-expected-dock">0</strong></span>
            <span class="leg leg-critOn">🟥 会心ダメージ <strong id="leg-critOn-dock">0</strong></span>
          </div>
        </div>
      </section>
    </div>
  </div>
</body>
</html>
