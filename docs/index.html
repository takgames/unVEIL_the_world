<!doctype html>
<html lang="ja" data-theme="auto">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
    <title>unVEIL the world ダメージシミュレーター</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="app-header container">
      <h1>unVEIL the world ダメージシミュレーター</h1>
      <div class="header-actions">
        <button id="resetBtn" class="btn" aria-label="リセット">リセット</button>
        <button id="shareBtn" class="btn" aria-haspopup="dialog" aria-controls="shareDialog">共有URL</button>
        <button id="themeBtn" class="btn" aria-label="テーマ切替">ライト/ダーク</button>
      </div>
    </header>

    <main class="container main-grid" id="appRoot" tabindex="-1">
      <!-- プリセット -->
      <details id="grpPreset" class="card" aria-labelledby="lblPreset">
        <summary id="lblPreset">プリセット</summary>
        <div class="card-body grid gap">
          <div class="grid two-cols">
            <label class="stack">
              <span>プリセット名</span>
              <input id="presetName" type="text" placeholder="例) アタッカー汎用" />
            </label>
            <label class="stack">
              <span>プリセット一覧</span>
              <select id="presetSelect"></select>
            </label>
          </div>
          <div class="row wrap gap">
            <button id="savePreset" class="btn">保存/上書き</button>
            <button id="renamePreset" class="btn">名前変更</button>
            <button id="deletePreset" class="btn danger">削除</button>
            <span class="muted" id="presetHint">ローカル保存 (ブラウザ内)</span>
          </div>
        </div>
      </details>

      <!-- ステータス -->
      <details id="grpStatus" class="card" open>
        <summary>ステータス</summary>
        <div class="card-body grid two-cols gap">
          <label class="stack"><span>基礎攻撃力</span><input type="number" id="baseAtk" min="0" step="1" /></label>
          <label class="stack"><span>補正攻撃力</span><input type="number" id="bonusAtk" min="0" step="1" value="0" /></label>
          <label class="stack"><span>会心率 %</span><input type="number" id="critRate" min="0" max="100" step="0.1" /></label>
          <label class="stack"><span>会心ダメージ %</span><input type="number" id="critDmg" min="0" step="0.1" /></label>
        </div>
      </details>

      <!-- 装備 -->
      <details id="grpEquip" class="card">
        <summary>装備</summary>
        <div class="card-body grid gap">
          <div class="equip-grid">
            <!-- グローブ -->
            <fieldset class="equip-card"><legend>グローブ</legend>
              <div class="grid two-cols gap">
                <label class="stack"><span>メイン (攻撃力 固定)</span><input type="number" data-main-type="atk" data-slot="glove" class="mainVal" min="0" step="1"></label>
                <div></div>
              </div>
              <div class="subgrid">
                <label class="stack"><span>サブ 攻撃力</span><input type="number" data-sub="atk" data-slot="glove" min="0" step="1"></label>
                <label class="stack"><span>サブ 攻撃力補正 %</span><input type="number" data-sub="atkPct" data-slot="glove" min="0" step="0.1"></label>
                <label class="stack"><span>サブ 会心率 %</span><input type="number" data-sub="critRate" data-slot="glove" min="0" step="0.1"></label>
                <label class="stack"><span>サブ 会心ダメージ %</span><input type="number" data-sub="critDmg" data-slot="glove" min="0" step="0.1"></label>
              </div>
            </fieldset>

            <!-- 服 -->
            <fieldset class="equip-card"><legend>服</legend>
              <div class="grid two-cols gap">
                <label class="stack"><span>メイン (その他 固定)</span><input type="number" data-main-type="other" data-slot="armor" class="mainVal" min="0" step="1" placeholder="—"></label>
                <div></div>
              </div>
              <div class="subgrid">
                <label class="stack"><span>サブ 攻撃力</span><input type="number" data-sub="atk" data-slot="armor" min="0" step="1"></label>
                <label class="stack"><span>サブ 攻撃力補正 %</span><input type="number" data-sub="atkPct" data-slot="armor" min="0" step="0.1"></label>
                <label class="stack"><span>サブ 会心率 %</span><input type="number" data-sub="critRate" data-slot="armor" min="0" step="0.1"></label>
                <label class="stack"><span>サブ 会心ダメージ %</span><input type="number" data-sub="critDmg" data-slot="armor" min="0" step="0.1"></label>
              </div>
            </fieldset>

            <!-- 紋章 -->
            <fieldset class="equip-card"><legend>紋章</legend>
              <div class="grid two-cols gap">
                <label class="stack">
                  <span>メイン 種類</span>
                  <select data-slot="emblem" class="mainType">
                    <option value="atk">攻撃力</option>
                    <option value="atkPct">攻撃力補正 %</option>
                    <option value="elemDmgPct">属性ダメージ %</option>
                    <option value="other">その他</option>
                  </select>
                </label>
                <label class="stack"><span>メイン 値</span><input type="number" data-slot="emblem" class="mainVal" min="0" step="0.1" placeholder="—"></label>
              </div>
              <div class="subgrid">
                <label class="stack"><span>サブ 攻撃力</span><input type="number" data-sub="atk" data-slot="emblem" min="0" step="1"></label>
                <label class="stack"><span>サブ 攻撃力補正 %</span><input type="number" data-sub="atkPct" data-slot="emblem" min="0" step="0.1"></label>
                <label class="stack"><span>サブ 会心率 %</span><input type="number" data-sub="critRate" data-slot="emblem" min="0" step="0.1"></label>
                <label class="stack"><span>サブ 会心ダメージ %</span><input type="number" data-sub="critDmg" data-slot="emblem" min="0" step="0.1"></label>
              </div>
            </fieldset>

            <!-- 指輪 -->
            <fieldset class="equip-card"><legend>指輪</legend>
              <div class="grid two-cols gap">
                <label class="stack">
                  <span>メイン 種類</span>
                  <select data-slot="ring" class="mainType">
                    <option value="atk">攻撃力</option>
                    <option value="atkPct">攻撃力補正 %</option>
                    <option value="critRate">会心率 %</option>
                    <option value="critDmg">会心ダメージ %</option>
                    <option value="other">その他</option>
                  </select>
                </label>
                <label class="stack"><span>メイン 値</span><input type="number" data-slot="ring" class="mainVal" min="0" step="0.1" placeholder="—"></label>
              </div>
              <div class="subgrid">
                <label class="stack"><span>サブ 攻撃力</span><input type="number" data-sub="atk" data-slot="ring" min="0" step="1"></label>
                <label class="stack"><span>サブ 攻撃力補正 %</span><input type="number" data-sub="atkPct" data-slot="ring" min="0" step="0.1"></label>
                <label class="stack"><span>サブ 会心率 %</span><input type="number" data-sub="critRate" data-slot="ring" min="0" step="0.1"></label>
                <label class="stack"><span>サブ 会心ダメージ %</span><input type="number" data-sub="critDmg" data-slot="ring" min="0" step="0.1"></label>
              </div>
            </fieldset>

            <!-- ブローチ -->
            <fieldset class="equip-card"><legend>ブローチ</legend>
              <div class="grid two-cols gap">
                <label class="stack">
                  <span>メイン 種類</span>
                  <select data-slot="brooch" class="mainType">
                    <option value="atk">攻撃力</option>
                    <option value="atkPct">攻撃力補正 %</option>
                    <option value="critDmg">会心ダメージ %</option>
                    <option value="other">その他</option>
                  </select>
                </label>
                <label class="stack"><span>メイン 値</span><input type="number" data-slot="brooch" class="mainVal" min="0" step="0.1" placeholder="—"></label>
              </div>
              <div class="subgrid">
                <label class="stack"><span>サブ 攻撃力</span><input type="number" data-sub="atk" data-slot="brooch" min="0" step="1"></label>
                <label class="stack"><span>サブ 攻撃力補正 %</span><input type="number" data-sub="atkPct" data-slot="brooch" min="0" step="0.1"></label>
                <label class="stack"><span>サブ 会心率 %</span><input type="number" data-sub="critRate" data-slot="brooch" min="0" step="0.1"></label>
                <label class="stack"><span>サブ 会心ダメージ %</span><input type="number" data-sub="critDmg" data-slot="brooch" min="0" step="0.1"></label>
              </div>
            </fieldset>
          </div>

          <!-- 合計 -->
          <div class="totals card subtle">
            <div class="totals-row"><span>装備 攻撃力 合計</span><output id="sumEquipAtk">0</output></div>
            <div class="totals-row"><span>装備 攻撃力補正 % 合計</span><output id="sumEquipAtkPct">0</output></div>
            <div class="totals-row"><span>装備 会心率 % 合計</span><output id="sumEquipCritRate">0</output></div>
            <div class="totals-row"><span>装備 会心ダメージ % 合計</span><output id="sumEquipCritDmg">0</output></div>
            <div class="totals-row"><span>装備 属性ダメージ % 合計</span><output id="sumEquipElemDmgPct">0</output></div>
          </div>
        </div>
      </details>

      <!-- スキル -->
      <details id="grpSkill" class="card" open>
        <summary>スキル</summary>
        <div class="card-body grid two-cols gap">
          <label class="stack"><span>スキル攻撃 %</span><input type="number" id="skillPct" min="0" step="0.1" /></label>
          <label class="stack"><span>スキル固定値</span><input type="number" id="skillFlat" min="0" step="1" value="0" /></label>
        </div>
      </details>

      <!-- 戦闘中効果 -->
      <details id="grpBattle" class="card" open>
        <summary>戦闘中効果</summary>
        <div class="card-body grid two-cols gap">
          <label class="stack"><span>攻撃力アップ %</span><input type="number" id="atkUpPct" min="0" step="0.1" value="0" /></label>
          <label class="stack"><span>ダメージアップ %</span><input type="number" id="dmgUpPct" min="0" step="0.1" value="0" /></label>
          <label class="stack"><span>カードダメージアップ %</span><input type="number" id="cardDmgUpPct" min="0" step="0.1" value="0" /></label>
          <label class="stack"><span>属性ダメージアップ %</span><input type="number" id="elemDmgUpPct" min="0" step="0.1" value="0" /></label>
        </div>
      </details>

      <!-- 敵の詳細 -->
      <details id="grpEnemy" class="card" open>
        <summary>敵の詳細</summary>
        <div class="card-body grid two-cols gap">
          <label class="stack"><span>防御力</span><input type="number" id="enemyDef" min="0" step="1" value="0" /></label>
          <label class="stack"><span>属性相性</span>
            <select id="affinity">
              <option value="none">なし</option>
              <option value="adv">有利</option>
              <option value="dis">不利</option>
            </select>
          </label>
          <label class="row align-center gap-sm checkbox-inline"><input type="checkbox" id="isBreak" /> <span>ブレイク状態</span></label>
        </div>
      </details>

      <!-- 計算の内訳 -->
      <details id="grpBreakdown" class="card">
        <summary>計算の内訳</summary>
        <div class="card-body">
          <div class="breakdown-grid">
            <div><span class="muted">装備補正攻撃力</span><output id="outEquipAdjAtk">0</output></div>
            <div><span class="muted">最終攻撃力</span><output id="outFinalAtk">0</output></div>
            <div><span class="muted">スキル倍率 適用後</span><output id="outAfterSkillMult">0</output></div>
            <div><span class="muted">スキル固定値 加算後</span><output id="outAfterSkillAdd">0</output></div>
            <div><span class="muted">ダメージアップ % 適用後</span><output id="outAfterDmgUp">0</output></div>
            <div><span class="muted">カードダメージアップ % 適用後</span><output id="outAfterCardUp">0</output></div>
            <div><span class="muted">総 属性ダメージ %</span><output id="outAllElemPct">0</output></div>
            <div><span class="muted">属性ダメージ % 適用後</span><output id="outAfterElemUp">0</output></div>
            <div><span class="muted">属性相性 倍率</span><output id="outAffinity">1.00</output></div>
            <div><span class="muted">属性相性 適用後</span><output id="outAfterAffinity">0</output></div>
            <div><span class="muted">ブレイク 倍率</span><output id="outBreak">1.00</output></div>
            <div><span class="muted">ブレイク 適用後</span><output id="outAfterBreak">0</output></div>
            <div><span class="muted">防御係数</span><output id="outDefCoeff">1.00</output></div>
            <div><span class="muted">防御係数 適用後（基礎ダメージ）</span><output id="outAfterDefense">0</output></div>
            <div><span class="muted">総 会心率 % (上限100)</span><output id="outAllCritRate">0</output></div>
            <div><span class="muted">総 会心ダメージ %</span><output id="outAllCritDmg">0</output></div>
          </div>
        </div>
      </details>
    </main>

    <!-- 結果 (常時 下部表示) -->
    <section class="results" aria-live="polite">
      <div class="container results-inner">
        <div class="results-head row space-between align-center">
          <strong>結果</strong>
          <div class="row gap-sm legend">
            <span class="chip chip-normal">通常</span>
            <span class="chip chip-avg">平均</span>
            <span class="chip chip-crit">会心</span>
          </div>
        </div>
        <div class="chart" role="img" aria-label="ダメージチャート">
          <div class="bar bar-normal" id="barNormal"></div>
          <div class="bar bar-avg" id="barAvg"></div>
          <div class="bar bar-crit" id="barCrit"></div>
          <div class="chart-scale" id="chartScale"></div>
        </div>
        <div class="results-values">
          <div><span class="muted">通常</span><output id="outNormal">0</output></div>
          <div><span class="muted">平均</span><output id="outAverage">0</output></div>
          <div><span class="muted">会心</span><output id="outCrit">0</output></div>
        </div>
      </div>
    </section>

    <footer class="app-footer container">
      <div>©2025 Tak</div>
      <div class="muted small">本シミュレーターは実測検証に基づいた近似値の推測を目的としているため、実際のゲームプレイにおける結果と一致することを保証するものではありません。</div>
    </footer>

    <!-- 共有ダイアログ（2ボタン方式） -->
    <dialog id="shareDialog">
      <form method="dialog" class="dialog-card">
        <h3>共有URLをコピー</h3>
        <p class="muted small">コピー形式を選んでください（圧縮は自動適用）</p>
        <div class="row gap">
          <button id="copyUrl" value="default" class="btn primary">URLをコピー</button>
          <button id="copyMd" value="default" class="btn">Markdownをコピー</button>
          <button value="cancel" class="btn">閉じる</button>
        </div>
      </form>
    </dialog>

    <!-- トースト -->
    <div id="toast" role="status" aria-live="polite"></div>

    <script src="app.js" defer></script>
  </body>
</html>