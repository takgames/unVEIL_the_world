/* =========================================================
   Base Theme Variables
========================================================= */
:root {
  --bg: #0b0f16;
  --card: #121b29;
  --text: #e0e6ee;
  --muted: #9bb0c3;
  --line: #2a3a52;
  --accent: #7bb6ff;
  --accent-soft: rgba(120,170,255,.25);
  --overlay: rgba(0,0,0,.45);
  
  --primary-bg: #4d92ff;
  --primary-bg-hover: #3f83ff;
  --primary-border: #6aa4ff;

  --danger-text: #ff9aa6;
  --danger-border: #ff7a88;
  --danger-soft: rgba(200,60,80,.16);

  /* Chart colors */
  --bar1-1:#5fa0ff; --bar1-2:#7bb6ff;
  --bar2-1:#75d08c; --bar2-2:#9be2aa;
  --bar3-1:#ff7979; --bar3-2:#ff9ea3;
  
  --content-max: 1120px;
  --content-pad: 1rem;

  --opt-bg: var(--card);
  --opt-fg: var(--text);
  --opt-hover: rgba(123, 182, 255, .28);   /* ホバー */
  --opt-checked: rgba(123, 182, 255, .45); /* 現在選択（＝checked） */
}

[data-theme="light"] {
  --bg:#f6f8fc;
  --card:#ffffff;
  --text:#1b2330;
  --muted:#506070;
  --line:#dbe4f0;
  --accent:#2b71f7;
  --accent-soft:rgba(43,113,247,.18);
  --overlay: rgba(0,0,0,.35);
  --primary-bg: #2b71f7;
  --primary-bg-hover: #225fe0;
  --primary-border: #2f6bf0;
  --danger-text: #c33c47;
  --danger-border: #e26a73;
  --danger-soft: rgba(220,70,85,.18);
  --opt-bg: #fff;
  --opt-fg: #1b2330;
  --opt-hover: rgba(43, 113, 247, .18);
  --opt-checked: rgba(43, 113, 247, .28);
}

body {
  background: var(--bg);
  color: var(--text);
  font-family: "Segoe UI", "Hiragino Kaku Gothic ProN", sans-serif;
  margin: 0;
  padding: 1rem;
  transition: background .25s, color .25s;
}

.header-bar,
main{
  width: min(var(--content-max), 100%);
  margin-inline: auto;
  padding-inline: var(--content-pad);
  box-sizing: border-box;
}

/* =========================================================
   Header
========================================================= */
.header-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: .75rem;
  margin-bottom: 1rem;
}
.header-actions {
  display: flex;
  gap: .5rem;
  align-items: center;
}

h1 {
  font-size: 1.4rem;
  margin: 0;
}

/* =========================================================
   Buttons
========================================================= */
button {
  cursor: pointer;
  font-family: inherit;
  border: none;
  transition: background .2s, box-shadow .2s, transform .05s;
}

.btn-sm {
  font-size: .88rem;
  padding: 6px 10px;
  border-radius: 999px;
}

.primary{
  background: var(--primary-bg);
  border: 1px solid var(--primary-border);
  color: #fff;
  border-radius: 999px;
  padding: 8px 14px;
  font-weight: 600;
  box-shadow: 0 2px 8px rgba(0,0,0,.18);
}
.primary:hover{
  background: var(--primary-bg-hover);
  box-shadow: 0 3px 10px rgba(0,0,0,.22);
}
.primary:active{ transform: translateY(1px); }

.ghost {
  background: transparent;
  border: 1.5px solid var(--line);
  border-radius: 999px;
  color: var(--text);
}
.ghost:hover { background: rgba(127,150,200,.12); }

.reset-btn{
  font-size:.9rem;
  padding:6px 12px;
  border-radius:999px;
  background:transparent;
  color: var(--danger-text);
  border:1.5px solid var(--danger-border);
  font-weight: 600;
}
.reset-btn:hover{
  background: var(--danger-soft);
  box-shadow: 0 0 0 3px rgba(0,0,0,0); /* 余計な外枠を抑止 */
  border-color: var(--danger-border);
}
.reset-btn:active{ transform: translateY(1px); }

.share-btn {
  display: inline-flex;
  align-items: center;
  gap: .45rem;
  border: 1.5px solid var(--accent);
  color: var(--accent);
  background: transparent;
  border-radius: 999px;
}
.share-btn:hover {
  background: var(--accent-soft);
}
.share-icon { line-height: 1; font-size: .95rem; }

.btn-icon {
  padding:6px 8px;
  border-radius:10px;
  background:transparent;
  border:1px solid var(--line);
  color:var(--text);
}
.btn-icon:hover {
  background:rgba(127,150,200,.12);
}

/* =========================================================
   Cards (collapsible)
========================================================= */
.card {
  background: var(--card);
  border: 1px solid var(--line);
  border-radius: 20px;
  margin-bottom: 1rem;
  overflow: hidden;
  transition: background .25s, border .25s;
}

.card-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.75rem 1rem;
  font-weight: 700;
  font-size: 1.1rem;
  line-height: 1.4;
  cursor: pointer;
  user-select: none;
  position: relative;
  z-index: 2;
  transition: background 0.2s ease;
}

.card-header h2 {
  font-size: 1rem;
  font-weight: 700;
  margin: 0;
}

.card-header:hover {
  background: rgba(255, 255, 255, 0.05);
}

.card-header::after {
  content: "▾";
  font-size: 1rem;
  color: var(--muted);
  transition: transform 0.25s ease, color 0.25s ease;
}

.card.collapsed .card-header::after {
  transform: rotate(-90deg);
  color: var(--muted);
}

.card-body{
  padding: .75rem 1rem 1rem;
  overflow: hidden;
  max-height: 2000px;
  transition: max-height .28s ease, opacity .22s ease;
  opacity: 1;
}
.card.collapsed .card-body{
  max-height: 0;
  opacity: 0;
  padding-top: 0;
  padding-bottom: 0;
}

/* =========================================================
   Inputs / Forms
========================================================= */
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: .75rem .75rem;
}

label {
  display: flex;
  flex-direction: column;
  font-weight: 600;
  font-size: .95rem;
  gap: .3rem;
}

input, select {
  padding: .5rem .6rem;
  border: 1px solid var(--line);
  border-radius: 10px;
  background: transparent;
  color: var(--text);
  font-size: 1rem;
  transition: border-color .15s, box-shadow .15s;
}
input[type=number]::-webkit-inner-spin-button,
input[type=number]::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}
input:focus, select:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 2px var(--accent-soft);
}

.note {
  font-size: .85rem;
  color: var(--muted);
}

/* =========================================================
   Enemy group
========================================================= */
.enemy-grid {
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  align-items: center;
}

.break-check {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  user-select: none;
}
.break-check input[type="checkbox"] {
  width: 18px;
  height: 18px;
  accent-color: var(--accent);
  cursor: pointer;
}

/* =========================================================
   Result bar
========================================================= */
.bar.big {
  position: relative;
  height: 20px;
  border-radius: 999px;
  background: rgba(255,255,255,.08);
  overflow: hidden;
  margin-bottom: .6rem;
}
.bar.big .fill {
  position: absolute;
  left: 0; top: 0; height: 100%;
  transition: width .3s ease;
  border-radius: inherit;
}
.bar.big .fill.noCrit { background: linear-gradient(90deg,var(--bar1-1),var(--bar1-2)); z-index:3; }
.bar.big .fill.expected { background: linear-gradient(90deg,var(--bar2-1),var(--bar2-2)); z-index:2; opacity:0.8;}
.bar.big .fill.critOn { background: linear-gradient(90deg,var(--bar3-1),var(--bar3-2)); z-index:1; opacity:0.6;}

.legend {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  font-weight: 600;
}
.legend strong {
  color: var(--accent);
  font-size: 1.05rem;
}

/* Result animation */
#result-body.changed {
  animation: resultPulse .38s ease;
}
@keyframes resultPulse {
  from { transform: scale(0.995); opacity: .92; }
  to { transform: scale(1); opacity: 1; }
}

/* =========================================================
   Preset Layout
========================================================= */
.preset-row {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  justify-content: space-between;
}
.left-group, .right-group {
  flex: 1 1 300px;
  display: flex;
  flex-direction: column;
  gap: .5rem;
}
.btn-row {
  display: flex;
  flex-wrap: wrap;
  gap: .5rem;
}

/* =========================================================
   Help Modal
========================================================= */
.overlay {
  position: fixed;
  inset: 0;
  background: var(--overlay);
  backdrop-filter: blur(2px);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 50;
}
.overlay[aria-hidden="false"] { display: flex; }

.modal {
  width: min(680px, 92vw);
  background: var(--card);
  color: var(--text);
  border: 1px solid var(--line);
  border-radius: 14px;
  box-shadow: 0 12px 30px rgba(0,0,0,.4);
}
.modal-header, .modal-footer {
  padding: 12px 14px;
  border-bottom: 1px solid var(--line);
}
.modal-footer {
  border-top: 1px solid var(--line);
  border-bottom: 0;
  display: flex;
  justify-content: flex-end;
  gap: .5rem;
  align-items: center;
}
.modal-body { padding: 12px 16px; }
.modal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.modal ol { margin: 0; padding-left: 1.1rem; }

/* =========================================================
   Menu (Share dropdown)
========================================================= */
.menu-anchor { position: relative; }
.menu {
  position: absolute;
  right: 0; top: calc(100% + 6px);
  background: var(--card);
  border: 1px solid var(--line);
  border-radius: 10px;
  box-shadow: 0 6px 20px rgba(0,0,0,.35);
  padding: 6px;
  min-width: 180px;
  z-index: 20;
  display: none;
}
.menu[aria-hidden="false"] { display: block; }
.menu button {
  width: 100%;
  text-align: left;
  padding: 8px 10px;
  border-radius: 8px;
  background: transparent;
  border: 0;
  color: var(--text);
  font-size: .95rem;
}
.menu button:hover { background: rgba(127,150,200,.12); }

/* =========================================================
   Responsive tweaks
========================================================= */
@media (max-width: 560px) {
  .header-actions { gap: .35rem; }
  .legend { gap: .6rem; }
  .bar.big { height: 18px; }
  input, select { font-size: .95rem; }
}

/* ブラウザに明示的にダークUIを指示 */
select, option { color-scheme: dark; }
[data-theme="light"] select, 
[data-theme="light"] option { color-scheme: light; }

/* Firefox / Edge / Chrome の option 表示を統一 */
option{
  color: var(--opt-fg);
  background-color: var(--opt-bg);
}

/* ホバー行はやや濃く */
option:hover,
option:focus{
  background-color: var(--opt-hover) !important;
  color: var(--opt-fg) !important;
}

/* ★ 現在選択されている行（checked）はさらに濃く & 太字で区別 */
option:checked{
  background-color: var(--opt-checked) !important;
  color: var(--opt-fg) !important;
  font-weight: 700;
}

/* === 装備グリッド：レスポンシブ最適化 === */
/* 既存の .equip-grid を少し詰めて各列が収まるように */
.equip-grid{
  display:grid;
  grid-template-columns: 120px 170px 120px repeat(4, minmax(120px,1fr));
  gap:.5rem .6rem;
  align-items:center;
}
.equip-head{ font-weight:700; color:var(--muted); padding:.25rem .2rem; }
.equip-name{ font-weight:700; padding:.25rem .2rem; }
.equip-grid input, .equip-grid select{
  padding:.45rem .55rem;
  border:1px solid var(--line);
  border-radius:10px;
  background:transparent;
  color:var(--text);
}

/* 画面幅が狭いときは列幅・フォント・パディングを縮小 */
@media (max-width: 1200px){
  .equip-grid{ grid-template-columns: 110px 150px 110px repeat(4, minmax(110px,1fr)); }
  .equip-grid input, .equip-grid select{ padding:.4rem .5rem; font-size:.95rem; }
  .equip-head, .equip-name { font-size:.95rem; }
}
@media (max-width: 980px){
  .equip-grid{ grid-template-columns: 100px 140px 100px repeat(4, minmax(95px,1fr)); }
  .equip-grid input, .equip-grid select{ padding:.38rem .48rem; font-size:.93rem; }
  .equip-head, .equip-name { font-size:.93rem; }
}
@media (max-width: 820px){
  .equip-grid{ grid-template-columns: 92px 128px 92px repeat(4, minmax(88px,1fr)); }
  .equip-grid input, .equip-grid select{ padding:.34rem .45rem; font-size:.9rem; }
  .equip-head, .equip-name { font-size:.9rem; }
}

/* === 無効フィールドは枠線を非表示＆控えめに === */
.equip-grid input:disabled,
.equip-grid select:disabled{
  border-color: transparent !important;
  background: transparent !important;
  opacity: .6;
  pointer-events: none;
}
/* 固定表示のメイン種類（矢印なし・枠なし） */
.fixed-label{
  display:inline-flex; align-items:center;
  height: 38px;
  padding: 0 .25rem;
  color: var(--text);
  opacity: .9;
}

/* 合計表示 */
.equip-summary{
  margin-top:.6rem; border-top:1px solid var(--line); padding-top:.6rem;
  display:flex; flex-direction:column; gap:.35rem;
}
.equip-summary .sum-title{
  font-weight:700; color:var(--muted); font-size:.95rem;
}
.equip-summary .sum-row{
  display:flex; flex-wrap:wrap; gap:.75rem 1rem; font-size:.95rem;
}
.equip-summary strong{ color: var(--accent); }

/* ==== 合計のバッジ化 ==== */
.sum-badges{
  display:flex; flex-wrap:wrap; gap:.6rem 1rem; align-items:center;
}
.badge {
  display:inline-block;
  border-radius:999px;
  padding:.22rem .66rem;
  font-size:.88rem;
  font-weight:700;
  color:#fff;
  line-height:1;
  box-shadow:0 2px 6px rgba(0,0,0,.18);
}
.badge-flat{ background: var(--accent); }         /* 攻撃力(フラット) */
.badge-pct { background: #4ec28a; }               /* % 系 */
.badge-elem{ background: #d47aff; }               /* 属性ダメ % */
.badge-crit-rate { background:#36b0e5; }    /* 水色系 */
.badge-crit-dmg  { background:#ff8b5f; }    /* オレンジ系 */

.badge-block{ display:inline-flex; align-items:center; gap:.35rem; }
.badge-label{ font-weight:700; margin-right:.15rem; }

/* 上書き保存など成功時の軽いフラッシュ演出 */
.btn-flash-success{
  animation: btnFlash .9s ease;
}
@keyframes btnFlash {
  0%   { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0); }
  40%  { box-shadow: 0 0 0 6px rgba(76, 175, 80, .25); }
  100% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0); }
}

/* ==== 横スクロール対応 ==== */
.equip-scroll-wrapper {
  overflow-x: auto;
  -webkit-overflow-scrolling: touch; /* スマホ滑らかスクロール */
  padding-bottom: 0.3rem; /* スクロールバーとの間に余白 */
}

/* スクロール中でも部位名が見えるよう固定 */
.equip-grid {
  display: grid;
  grid-template-columns: 120px 170px 120px repeat(4, minmax(120px,1fr));
  align-items: center;
  min-width: 750px; /* ← 横幅を確保してスクロール発生 */
}

.equip-name {
  position: sticky;
  left: 0;
  background: var(--card);
  z-index: 2;
  padding-left: 0.3rem;
}
.equip-name {
  box-shadow: 4px 0 6px rgba(0,0,0,0.15);
}
[data-theme="light"] .equip-name {
  box-shadow: 4px 0 6px rgba(0,0,0,0.08);
}

/* スクロールバーのスタイル（見やすく） */
.equip-scroll-wrapper::-webkit-scrollbar {
  height: 8px;
}
.equip-scroll-wrapper::-webkit-scrollbar-thumb {
  background: rgba(255,255,255,0.2);
  border-radius: 4px;
}
[data-theme="light"] .equip-scroll-wrapper::-webkit-scrollbar-thumb {
  background: rgba(0,0,0,0.2);
}
.equip-scroll-wrapper::after {
  content: '⇄';
  position: absolute;
  right: 0.5rem;
  top: 0.3rem;
  font-size: 0.9rem;
  color: var(--muted);
  opacity: 0.6;
  pointer-events: none;
}

/* ==== 結果の固定バー ==== */
#resultFooter {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  z-index: 100;
  background: rgba(30, 30, 40, 0.92);
  backdrop-filter: blur(6px);
  border-top: 1px solid rgba(255,255,255,0.1);
  padding: 0.4rem 1rem;
  color: var(--text);
  font-size: 0.95rem;
  transition: background 0.3s;
}

[data-theme="light"] #resultFooter {
  background: rgba(255,255,255,0.92);
  border-top: 1px solid rgba(0,0,0,0.1);
}

.footer-inner {
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 0.5rem 1rem;
  max-width: 1200px;
  margin: 0 auto;
}

.footer-label {
  font-weight: 700;
  color: var(--accent);
  min-width: 3.5rem;
}

.footer-values {
  display: flex;
  gap: 1.2rem;
  align-items: center;
}

.footer-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  min-width: 4.5rem;
}

.footer-item .label {
  font-size: 0.75rem;
  opacity: 0.75;
}

.footer-item .value {
  font-size: 1rem;
  font-weight: 700;
  line-height: 1.1;
  color: var(--text);
}

/* スマホ最適化 */
@media (max-width: 600px) {
  #resultFooter {
    font-size: 0.9rem;
    padding: 0.4rem 0.6rem;
  }
  .footer-values {
    gap: 0.8rem;
  }
}
