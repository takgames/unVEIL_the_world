/* ===== ベースレイアウト ===== */
body {
  font-family: "Noto Sans JP", sans-serif;
  background: #0b0f16;
  color: #e0e6ee;
  margin: 0;
  padding: 0;
  line-height: 1.6;
}
.container {
  max-width: 880px;
  margin: 0 auto;
  padding: 1.5rem;
}
h1 {
  font-size: 1.6rem;
  margin-bottom: 1.2rem;
  text-align: center;
}
h2 {
  font-size: 1.2rem;
  margin: 0;
  font-weight: 600;
}
label {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}
input, select, button {
  font-family: inherit;
  font-size: 1rem;
  border-radius: 8px;
  border: 1px solid #3a4a63;
  padding: 0.4rem 0.6rem;
  background: #111926;
  color: #e0e6ee;
}
input:focus, select:focus, button:focus {
  outline: 2px solid #4d8df7;
  outline-offset: 2px;
}
button {
  background: #2b71f7;
  color: #fff;
  cursor: pointer;
  border: none;
  transition: background .15s;
}
button:hover {
  background: #3c84ff;
}
button.ghost {
  background: #1c2737;
  border: 1px solid #2f3e56;
}
button.ghost:hover {
  background: #2a3a52;
}
.note {
  font-size: 0.85rem;
  opacity: 0.8;
}
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 1rem;
}
.action {
  display: flex;
  justify-content: center;
  margin: 1rem 0;
  gap: 1rem;
}
.results {
  display: flex;
  flex-direction: column;
  gap: 0.6rem;
}
.results strong {
  font-size: 1.2rem;
  color: #78aaff;
}
.table-wrap {
  overflow-x: auto;
}
.breakdown {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.9rem;
}
.breakdown th, .breakdown td {
  border-bottom: 1px solid #2a364a;
  padding: 0.3rem 0.5rem;
}
.breakdown td.num {
  text-align: right;
}
footer {
  text-align: center;
  font-size: 0.8rem;
  opacity: 0.7;
  margin-top: 2rem;
}

/* ===== カード ===== */
.card {
  background: #121b29;
  border-radius: 12px;
  padding: 1rem 1.2rem;
  box-shadow: 0 0 10px rgba(0,0,0,0.3);
  margin-bottom: 1.2rem;
  transition: background .2s;
}
.card:hover {
  background: #162233;
}

/* ===== 折り畳み UI ===== */
.card-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  cursor: pointer;
  user-select: none;
  gap: 8px;
  margin: -4px -4px 12px;
  padding: 4px;
  border-radius: 10px;
}
.card-header:focus {
  outline: 2px solid #254a85;
  outline-offset: 2px;
}
.card-body {
  overflow: clip;
  transition: height .22s ease, opacity .22s ease;
  will-change: height;
}
.card.animating .card-body {
  pointer-events: none;
}
.card.collapsed .card-body {
  opacity: 0;
}
.chev {
  width: 10px;
  height: 10px;
  border-right: 2px solid #9bb0c3;
  border-bottom: 2px solid #9bb0c3;
  transform: rotate(45deg);
  transition: transform .18s ease;
  flex: 0 0 auto;
  margin-left: 8px;
  opacity: .9;
}
.card.collapsed .chev {
  transform: rotate(-45deg);
}
@media (prefers-reduced-motion: reduce) {
  .card-body { transition: none; }
}

/* ===== プリセット周り ===== */
.preset-toolbar {
  display: flex;
  justify-content: flex-end;
  margin-bottom: 8px;
}
.cluster {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
  align-items: center;
}
button.small {
  padding: 8px 12px;
  font-size: 14px;
}
#presetSelect, #presetName {
  min-width: 240px;
}
#banner {
  margin-top: 8px;
  font-size: 0.9rem;
  color: #90c8ff;
}
@media (max-width: 720px) {
  #presetSelect, #presetName {
    min-width: 100%;
  }
}

/* ===== プリセット レイアウト調整 ===== */
.preset-flex {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  flex-wrap: wrap;
  gap: 1.5rem;
}
.preset-left,
.preset-right {
  display: flex;
  flex-direction: column;
  gap: 0.8rem;
  flex: 1 1 320px;
}
.preset-left label,
.preset-right label {
  display: flex;
  flex-direction: column;
  gap: 0.4rem;
}
.preset-left .cluster,
.preset-right .cluster {
  display: flex;
  gap: 0.6rem;
  flex-wrap: wrap;
}
.preset-left button.small {
  align-self: flex-start;
}
@media (max-width: 640px) {
  .preset-flex { flex-direction: column; }
  .preset-left, .preset-right { flex: 1 1 100%; }
}

/* ===== ヘッダー右上の共有ボタン配置 ===== */
.header-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  margin-bottom: 1rem;
}
.header-bar h1 {
  font-size: 1.6rem;
  margin: 0;
}
.header-bar button {
  margin-top: 0.5rem;
}
@media (max-width: 520px) {
  .header-bar {
    flex-direction: column;
    align-items: flex-start;
    gap: 0.5rem;
  }
}

/* ===== ヘッダー共有ボタン（差別化スタイル） ===== */
.share-btn{
  display:inline-flex; align-items:center; gap:.45rem;
  padding:6px 10px; border-radius:999px;
  position:relative;
}
.share-icon{ line-height:1; font-size:.95rem; }

.share-btn:hover{
  border-color: rgba(120,170,255,.9);
  box-shadow: 0 0 0 3px rgba(120,170,255,.12);
  background: rgba(40,65,110,.25);
}

.share-btn:active{
  transform: translateY(1px);
}

.share-btn:focus{
  outline: none;
  box-shadow: 0 0 0 3px rgba(120,170,255,.18);
}

/* ダーク面での視認性向上（高コントラストモード配慮） */
@media (prefers-contrast: more){
  .share-btn{ border-color: #78aaff; color: #e8f2ff; }
}

/* ステータスは2列固定で会心率/会心ダメを並べる */
.status-grid{
  grid-template-columns: repeat(2, minmax(260px, 1fr));
}
@media (max-width: 640px){
  .status-grid{ grid-template-columns: 1fr; }
}

/* 結果：棒グラフ */
.bars{ display:flex; flex-direction:column; gap:1rem; }
.bar-row{ display:grid; grid-template-columns: 180px 1fr max-content; align-items:center; gap:12px; }
.bar-row .label{ opacity:.9 }
.bar{
  position:relative; height:16px; background:#0e1623; border:1px solid #26344b;
  border-radius:999px; overflow:hidden;
}
.bar .fill{
  height:100%; width:0%;
  background: linear-gradient(90deg, #5fa0ff, #7bb6ff);
  transition: width .35s ease;
}
.bar-row[data-key="critOn"] .fill{
  background: linear-gradient(90deg, #ff7a7a, #ff9fa5);
}
.bar-row[data-key="expected"] .fill{
  background: linear-gradient(90deg, #75d08c, #9be2aa);
}
.bar-row .value{
  min-width: 7ch; text-align:right; font-variant-numeric: tabular-nums;
  color:#cfe4ff;
}

/* 値更新の軽いハイライト */
.bar-row.updated .value{
  animation: flash .35s ease;
}
@keyframes flash { from { color:#fff; } to { color:#cfe4ff; } }

/* ── 単一バーに3値を重ねて表示 ───────────────── */
.stacked { display:flex; flex-direction:column; gap:.75rem; }
.bar.big{
  position:relative; height:22px; background:#0e1623;
  border:1px solid #26344b; border-radius:999px; overflow:hidden;
}
.bar.big .fill{
  position:absolute; left:0; top:0; height:100%; width:0%;
  transition: width .35s ease;
}
.bar.big .fill.critOn   { z-index: 1; background: linear-gradient(90deg,#ff7979,#ff9ea3); opacity:.85; }
.bar.big .fill.expected { z-index: 2; background: linear-gradient(90deg,#75d08c,#9be2aa); opacity:.75; }
.bar.big .fill.noCrit   { z-index: 3; background: linear-gradient(90deg,#5fa0ff,#7bb6ff); opacity:.95; }

/* 右端に細い目盛（終端）を付けて比較しやすくする */
.bar.big .fill::after{
  content:""; position:absolute; right:0; top:0; height:100%; width:2px;
  background: rgba(255,255,255,.6);
  mix-blend-mode:screen; opacity:.8;
}

/* 凡例（タイトル＋色チップ＋数値） */
.legend{ display:flex; gap:1rem; flex-wrap:wrap; }
.legend .leg{ display:flex; align-items:center; gap:.45rem; opacity:.95 }
.legend .leg i{
  width:12px; height:12px; border-radius:3px; display:inline-block;
}
.legend .leg.noCrit i{ background:linear-gradient(90deg,#5fa0ff,#7bb6ff); }
.legend .leg.critOn i{ background:linear-gradient(90deg,#ff7979,#ff9ea3); }
.legend .leg.expected i{ background:linear-gradient(90deg,#75d08c,#9be2aa); }
.legend .leg b{
  font-variant-numeric: tabular-nums; color:#cfe4ff; font-weight:600;
}

/* 数値更新の軽いハイライト */
.legend .leg.updated b{ animation: flashLeg .35s ease; }
@keyframes flashLeg{ from{ color:#fff; } to{ color:#cfe4ff; } }

/* ヘッダー並び（ボタングループ） */
.header-bar{
  display:flex; justify-content:space-between; align-items:center;
  flex-wrap:wrap; margin-bottom:1rem;
}
.header-actions{ display:flex; gap:.5rem; align-items:center; }

/* リセット（危険操作の控えめスタイル） */
.reset-btn{
  font-size:.95rem; padding:8px 12px; border-radius:999px;
  background:transparent; color:#ffd3d3;
  border:1.5px solid rgba(255,140,140,.55);
  transition: border-color .15s, box-shadow .15s, background-color .15s, transform .04s;
}
.reset-btn:hover{
  border-color:rgba(255,140,140,.9);
  background:rgba(120,40,40,.18);
  box-shadow:0 0 0 3px rgba(255,140,140,.12);
}
.reset-btn:active{ transform:translateY(1px); }
.reset-btn:focus{ outline:none; box-shadow:0 0 0 3px rgba(255,140,140,.18); }

/* 小さめボタン共通 */
.btn-sm{ font-size:.88rem; padding:6px 10px; }

/* ヘッダー右側の並び */
.header-actions{ display:flex; gap:.5rem; align-items:center; }
.menu-anchor{ position:relative; }

/* ミニメニュー */
.menu{
  position:absolute; right:0; top:calc(100% + 6px);
  background:#0f1724; border:1px solid #2a3a52;
  border-radius:10px; box-shadow:0 6px 20px rgba(0,0,0,.35);
  padding:6px; min-width: 180px; z-index: 20;
  display:none;
}
.menu[aria-hidden="false"]{ display:block; }
.menu button{
  width:100%; text-align:left; padding:8px 10px; border-radius:8px;
  background:transparent; border:0; color:#e0e6ee; font-size:.95rem;
}
.menu button:hover{ background:#18233a; }
.menu button:active{ background:#1f2c46; }

/* ===== 敵セクション（チェック配置修正） ===== */
.enemy-grid {
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  align-items: center;
}

.break-check {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  user-select: none;
}

.break-check input[type="checkbox"] {
  width: 18px;
  height: 18px;
  accent-color: #7bb6ff; /* ブルー系チェック */
  cursor: pointer;
}

/* number のスピンボタン非表示（Chrome/Edge/Safari） */
input[type=number]::-webkit-outer-spin-button,
input[type=number]::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

/* フォーカス時のリング統一（input / select） */
input, select {
  transition: border-color .15s, box-shadow .15s, background-color .15s;
}
input:focus, select:focus {
  outline: none;
  border-color: #7bb6ff;
  box-shadow: 0 0 0 2px rgba(120,170,255,.25);
}

/* === 結果の軽いアニメーション === */
#result-body.changed {
  animation: resultPulse .38s ease;
}
@keyframes resultPulse {
  from { transform: scale(0.995); opacity: .92; }
  to   { transform: scale(1);     opacity: 1; }
}

/* === Theme Variables === */
:root{
  --bg: #0b0f16; --card:#121b29; --text:#e0e6ee; --muted:#9bb0c3;
  --line:#2a3a52; --accent:#7bb6ff; --accent-soft:rgba(120,170,255,.25);
  --bar1-1:#5fa0ff; --bar1-2:#7bb6ff; --bar2-1:#75d08c; --bar2-2:#9be2aa; --bar3-1:#ff7979; --bar3-2:#ff9ea3;
  --overlay: rgba(0,0,0,.45);
}
[data-theme="light"]{
  --bg:#f6f8fc; --card:#ffffff; --text:#1b2330; --muted:#506070;
  --line:#dbe4f0; --accent:#2b71f7; --accent-soft:rgba(43,113,247,.18);
  --overlay: rgba(0,0,0,.35);
}
body{ background:var(--bg); color:var(--text); transition:background .25s, color .25s; }
.card{ background:var(--card); }
.breakdown th,.breakdown td{ border-bottom:1px solid var(--line); }

/* 結果バーの色を変数に寄せる（既存の定義を上書き） */
.bar.big .fill.noCrit{ background:linear-gradient(90deg,var(--bar1-1),var(--bar1-2)); }
.bar.big .fill.expected{ background:linear-gradient(90deg,var(--bar2-1),var(--bar2-2)); }
.bar.big .fill.critOn{ background:linear-gradient(90deg,var(--bar3-1),var(--bar3-2)); }

/* ヘッダーの小アイコンボタン */
.btn-icon{
  padding:6px 8px; border-radius:10px; background:transparent; border:1px solid var(--line); color:var(--text);
}
.btn-icon:hover{ background:rgba(127,150,200,.12); }
.btn-sm{ font-size:.88rem; padding:6px 10px; }

/* モバイル微調整 */
@media (max-width:560px){
  .header-actions{ gap:.35rem; }
  .legend{ gap:.6rem; }
  .bar.big{ height:18px; }
}

/* Help modal */
.overlay{
  position:fixed; inset:0; background:var(--overlay);
  backdrop-filter: blur(2px);
  display:none; align-items:center; justify-content:center; z-index:50;
}
.overlay[aria-hidden="false"]{ display:flex; }
.modal{
  width:min(680px, 92vw); background:var(--card); color:var(--text);
  border:1px solid var(--line); border-radius:14px; box-shadow:0 12px 30px rgba(0,0,0,.4);
}
.modal-header,.modal-footer{ padding:12px 14px; border-bottom:1px solid var(--line); }
.modal-footer{ border-top:1px solid var(--line); border-bottom:0; display:flex; justify-content:flex-end; gap:.5rem; align-items:center; }
.modal-body{ padding:12px 16px; }
.modal-header{ display:flex; align-items:center; justify-content:space-between; }
.modal ol{ margin:0; padding-left:1.1rem; }
